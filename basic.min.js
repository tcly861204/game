window.onload=function(){var oDiv=document.getElementById('div');var starBtn=document.getElementById('gameBtn');oDiv.style.width=window.innerWidth+'px';oDiv.style.height=window.innerHeight+'px';starBtn.onclick=function(){this.style.display='none';Game.init('div');}}
var Game={oEnemy:{e1:{style:'enemy1',blood:1,speed:5,score:1},e2:{style:'enemy2',blood:2,speed:7,score:1},e3:{style:'enemy3',blood:3,speed:10,score:1}},gk:[{eMap:['e2','e2','e2','e2','e2','e2','e2','e2','e2','e2','e2','e2','e2','e2','e2','e2','e2','e2','e2','e2','e2','e2','e2','e2','e2','e2','e2','e2','e2','e2','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1'],colNum:10,iSpeedX:10,iSpeedY:5,times:2000},{eMap:['e3','e3','e3','e3','e3','e3','e3','e3','e3','e3','e3','e3','e3','e3','e3','e3','e3','e3','e3','e3','e3','e3','e3','e3','e3','e3','e3','e3','e3','e3','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1','e1'],colNum:10,iSpeedX:10,iSpeedY:5,times:2000}],air:{style:'air',bulletstyle:'bullet',},init:function(id){this.oParent=document.getElementById(id);this.createScore();this.createEnemy(0);this.creatAir();},createScore:function(){var oS=document.createElement('div');oS.id='score';oS.innerHTML='积分：<span>0</span>';this.oParent.appendChild(oS);this.oSNum=oS.getElementsByTagName("span")[0];},createEnemy:function(iNow){if(this.oUl){clearInterval(this.oUl.timer);this.oParent.removeChild(this.oUl);}
document.title="第"+(iNow+1)+"关";var gk=this.gk[iNow];var arr=[];var oUl=document.createElement('ul');oUl.id='bee';oUl.style.width=gk.colNum*40+'px';this.oParent.appendChild(oUl);oUl.style.left=(this.oParent.offsetWidth-oUl.offsetWidth)/2+'px';this.oUl=oUl;for(var i=0;i<gk.eMap.length;i++){var oLi=document.createElement('li');oLi.className=this.oEnemy[gk.eMap[i]].style;oLi.blood=this.oEnemy[gk.eMap[i]].blood;oLi.speed=this.oEnemy[gk.eMap[i]].score;oLi.score=this.oEnemy[gk.eMap[i]].speed;oUl.appendChild(oLi);}
this.aLi=oUl.getElementsByTagName("li");for(var i=0;i<this.aLi.length;i++){arr.push([this.aLi[i].offsetLeft,this.aLi[i].offsetTop]);}
for(var i=0;i<this.aLi.length;i++){this.aLi[i].style.position="absolute";this.aLi[i].style.left=arr[i][0]+'px';this.aLi[i].style.top=arr[i][1]+'px';}
this.runEnemy(gk);},runEnemy:function(gk){var _this=this;var L=0;var R=this.oParent.offsetWidth-this.oUl.offsetWidth;this.oUl.timer=setInterval(function(){if(_this.oUl.offsetLeft>=R){gk.iSpeedX*=-1;_this.oUl.style.top=_this.oUl.offsetTop+gk.iSpeedY+'px';}else if(_this.oUl.offsetLeft<=L){gk.iSpeedX*=-1;_this.oUl.style.top=_this.oUl.offsetTop+gk.iSpeedY+'px';}
_this.oUl.style.left=_this.oUl.offsetLeft+gk.iSpeedX+'px';},200);setInterval(function(){_this.oneMove();},gk.times);},oneMove:function(){var _this=this;var nowLi=this.aLi[Math.floor(Math.random()*this.aLi.length)];nowLi.timer=setInterval(function(){var a=(_this.oA.offsetLeft+_this.oA.offsetWidth/2)-(nowLi.offsetLeft+nowLi.parentNode.offsetLeft+nowLi.offsetWidth/2);var b=(_this.oA.offsetTop+_this.oA.offsetHeight/2)-(nowLi.offsetTop+nowLi.parentNode.offsetTop+nowLi.offsetHeight/2);var c=Math.sqrt(a*a+b*b);var isX=nowLi.speed*a/c;var isY=nowLi.speed*b/c;nowLi.style.left=nowLi.offsetLeft+isX+'px';nowLi.style.top=nowLi.offsetTop+isY+'px';if(_this.pz(_this.oA,nowLi)){clearInterval(nowLi.timer);alert('游戏结束');window.location.reload();}},30);},creatAir:function(){var oA=document.createElement('div');oA.className=this.air.style;this.oA=oA;this.oParent.appendChild(oA);oA.style.left=(this.oParent.offsetWidth-oA.offsetWidth)/2+'px';oA.style.top=this.oParent.offsetHeight-oA.offsetHeight+'px';this.bindAir();},bindAir:function(){var timer=null;var iNum=0;var _this=this;document.onkeydown=function(ev){var ev=ev||window.event;if(!timer){timer=setInterval(show,30);}
if(ev.keyCode==37){iNum=1;}else if(ev.keyCode==39){iNum=2;}else if(ev.keyCode==38){iNum=3;}else if(ev.keyCode==40){iNum=4;}};document.onkeyup=function(ev){var ev=ev||window.event;if(ev.keyCode==32){_this.createBullet();}
clearInterval(timer);timer=null;iNum=0;}
function show(){switch(iNum){case 1:if(_this.oA.offsetLeft>=0)
_this.oA.style.left=_this.oA.offsetLeft-10+'px';break;case 2:if(_this.oA.offsetLeft<=(window.innerWidth-_this.oA.offsetWidth))
_this.oA.style.left=_this.oA.offsetLeft+10+'px';break;case 3:if(_this.oA.offsetTop>=0)
_this.oA.style.top=_this.oA.offsetTop-10+'px';break;case 4:if(_this.oA.offsetTop<=(window.innerHeight-_this.oA.offsetHeight))
_this.oA.style.top=_this.oA.offsetTop+10+'px';break;}}},createBullet:function(){var oB=document.createElement('div');oB.className=this.air.bulletstyle;this.oParent.appendChild(oB);oB.style.left=this.oA.offsetLeft+this.oA.offsetWidth/2+'px';oB.style.top=this.oA.offsetTop-10+'px';this.runBullet(oB);},runBullet:function(oB){var _this=this;oB.timer=setInterval(function(){if(oB.offsetTop<-10){clearInterval(oB.timer);_this.oParent.removeChild(oB);}else{oB.style.top=oB.offsetTop-10+'px';}
for(var i=0;i<_this.aLi.length;i++){if(_this.pz(oB,_this.aLi[i])){if(_this.aLi[i].blood==1){clearInterval(_this.aLi[i].timer);_this.oSNum.innerHTML=parseInt(_this.oSNum.innerHTML)+_this.aLi[i].score;_this.oUl.removeChild(_this.aLi[i]);}else{_this.aLi[i].blood--;}
clearInterval(oB.timer);_this.oParent.removeChild(oB);}}
if(!_this.aLi.length){_this.createEnemy(1);}},30);},pz:function(obj1,obj2){var L1=obj1.offsetLeft;var R1=obj1.offsetLeft+obj1.offsetWidth;var T1=obj1.offsetTop;var B1=obj1.offsetTop+obj1.offsetHeight;var L2=obj2.offsetLeft+obj2.parentNode.offsetLeft;var R2=obj2.offsetLeft+obj2.offsetWidth+obj2.parentNode.offsetLeft;var T2=obj2.offsetTop+obj2.parentNode.offsetTop;var B2=obj2.offsetTop+obj2.offsetHeight+obj2.parentNode.offsetTop;if(R1<L2||R2<L1||B1<T2||B2<T1){return false;}else{return true;}}};